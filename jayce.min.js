!function(r,e){"function"==typeof define?define(e):"object"==typeof module&&"object"==typeof module.exports?module.exports=e():r.jayce=e()}(this,function(){function r(r,e){var n=0,t=r.length;if(t)for(;t>n;)e(r[n],n++);else for(var u in r)e(r[u],u);return r}function e(r){return r.replace(/\s/g,"")}function n(r){return String(r).replace(/("|\\)/g,"\\$1").replace(/\r/g,"\\r").replace(/\n/g,"\\n")}function t(r){return v[r]}function u(r){return String(r).replace(/&(?![\w#]+;)|[<>"']/g,t)}function a(n,t){function u(r){return"_out+="+r+";"}function a(r){var e=r.split(","),n=e[0];c.push(n);var t=e[1],u=e[2];return"_$.forEach("+n+", function("+t+(u?","+u:"")+"){"}function i(e){var n,t=e.split(/\|+/);return r(t,function(r,e){0===e?(n=r,c.push(r.split(".")[0])):n="_$$."+r+"("+n+")"}),n}var c=t.vars,f=t.if_m,o=t.each_m;if(3===n.length){var s="",p=e(n[0]),l=n[1],v=n[2];if((""===p||"#"===p)&&!h.test(l))return u('"{'+n[0]+l+"}"+v+'"');switch(l){case"$":"#"===p.charAt(0)?p=p.substr(1):s=u("_$.escape("+i(p)+")");break;case"?":t.if_m=f+1,r(p.match(_),function(r){/\./.test(r)||c.push(r)}),s="if("+p+"){";break;case":?":if(0===f)return u('"{'+n[0]+l+"}"+v+'"');s=p?"}else if("+p+"){":"}else{";break;case"/?":if(0===f)return u('"{'+n[0]+l+"}"+v+'"');t.if_m=f-1,s="}";break;case"@":t.each_m=o+1,s=a(p);break;case"/@":if(0===o)return u('"{'+n[0]+l+"}"+v+'"');t.each_m=o-1,s="});"}return s+=u('"'+v+'"')}return u('"'+n[0]+'"')}function i(r){return function(e){return r(e,l,p)}}function c(e){if(s[e])return s[e];e=n(e);var t="",u={vars:[],if_m:0,each_m:0};r(e.split(m),function(r){r=r.split(d),t+=a(r,u)});var c='var _out="";data=data||{};';r(u.vars,function(r){c+="var "+r+"=data."+r+";"}),t=c+t+"return _out;";var f=new Function("data","_$","_$$",t);return s[e]=i(f)}function f(r,e){return c(r)(e)}function o(r,e){return p[r]=e,this}var s={},p={},l={};l.forEach=r;var v={"<":"&#60;",">":"&#62;",'"':"&#34;","'":"&#39;","&":"&#38;"};l.escape=u;var _=/\.?(?!\d)[\d\w_$]+/g,h=/(?:\/\?|:\?|\/@)/,m=/\{/g,d=/((?:\/|:)?[$?!@-])\}/g;return{compile:c,render:f,filter:o}});